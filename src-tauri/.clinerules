# .clinerules - RÃˆGLES ABSOLUTES POUR AGENT IA

## ğŸš¨ RÃˆGLE 0 : AUTO-VÃ‰RIFICATION SYSTÃ‰MATIQUE
// APRÃˆS CHAQUE GÃ‰NÃ‰RATION DE CODE, l'IA exÃ©cute AUTOMATIQUEMENT :
//   cargo fmt && cargo clippy -- -D warnings && cargo test
// Si Ã©chec â†’ NE PAS LIVRER LE CODE. Corriger d'abord.
// Si succÃ¨s â†’ Livrer avec rapport de conformitÃ©.

## ğŸ›¡ï¸ RÃˆGLE 1 : ZÃ‰RO COMMIT AUTOMATIQUE (INTERDICTION ABSOLUE)
// L'IA NE MENTIONNE JAMAIS : "git commit", "git push", "git add"
// L'IA NE SAIT PAS que git existe. C'est Ã  l'utilisateur de dÃ©cider.

## ğŸ§¹ RÃˆGLE 2 : ZÃ‰RO CODE MORT
// AVANT GÃ‰NÃ‰RATION, l'IA analyse et SUPPRIME code mort :
//   - Fonctions jamais appelÃ©es (dead_code)
//   - Imports inutilisÃ©s
//   - Variables non utilisÃ©es
// Pas de code commentÃ© >3 lignes.

## ğŸ§ª RÃˆGLE 3 : TESTS SystÃ©matiques
// POUR CHAQUE FONCTION PUBLIQUE :
//   - GÃ©nÃ©rer test unitaire AVANT implÃ©mentation (TDD)
//   - ExÃ©cuter `cargo test` - DOIT PASSER
//   - Coverage >80% pour nouveaux modules
// PAS DE CODE LIVRÃ‰ SANS TESTS PASSANTS.

## ğŸ“ RÃˆGLE 4 : RESPECT STRICT .clinerules & Makefile
// L'IA ne peut PAS gÃ©nÃ©rer de code qui viole :
//   - Taille fichier <300 lignes
//   - Pas d'unwrap() hors tests
//   - Architecture DAG (pas d'import circulaire)
//   - ZERO mock data
// Si violation â†’ CORRIGER IMMÃ‰DIATEMENT.

## ğŸ“ RÃˆGLE 5 : LIMITES DE TAILLE STRICTES
// - Services: <300 lignes (HARD LIMIT)
// - Commands: <200 lignes
// - main.rs: <120 lignes
// Si approche â†’ WARN. Si dÃ©passe â†’ STOP + Split.

## ğŸ¯ RÃˆGLE 6 : ARCHITECTURE 3 NIVEAUX (DAG)
// NIVEAU 1: utils/config.rs, utils/logger.rs, models/errors.rs â†’ AUCUNE dÃ©pendance
// NIVEAU 2: db/cache.rs, services/api_client.rs â†’ DÃ©pend NIVEAU 1 SEULEMENT
// NIVEAU 3: services/trading.rs â†’ DÃ©pend NIVEAU 1+2
// NIVEAU 4: commands/*.rs â†’ DÃ©pend NIVEAU 3 SEULEMENT
// âŒ JAMAIS d'import entre services mÃªme niveau.

## ğŸ’¾ RÃˆGLE 7 : GESTION D'ERREURS UNIFIÃ‰E
// TOUTES fonctions publiques retournent Result<T, ServiceError>
// âŒ unwrap(), unwrap_or() interdits
// âœ… Utiliser ? pour propagation

## ğŸ”’ RÃˆGLE 8 : ANTI-PATTERNS INTERDITS
// âŒ unwrap() sans contexte | Mock data | Clone() >5x/fn
// âŒ Magic numbers | Code commentÃ© >3 lignes | panic!() services
// âŒ Import circulaire | pub sur tout
// Si dÃ©tectÃ© â†’ SUPPRIMER/CORRIGER automatiquement.

## ğŸ“ RÃˆGLE 9 : RAPPORT OBLIGATOIRE
// APRÃˆS CHAQUE TÃ‚CHE, l'IA affiche :
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… TÃ‚CHE COMPLÃ‰TÃ‰E : [nom]
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ Taille: [X] lignes - Conforme
// ğŸ§ª Tests: [X] tests Ã©crits - Passants
// ğŸ”’ Coverage: [X]% - OK
// âš ï¸  Warnings: [X]
// ğŸ§¹ Code mort: [X] lignes nettoyÃ©es
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ”§ RÃˆGLE 11 : IGNORER ERREURS DE COMPILATION DUES AUX DÃ‰PENDANCES
// Les erreurs de compilation liÃ©es aux dÃ©pendances systÃ¨me MANQUANTES sont IGNORÃ‰ES :
//   - cannot find -lwebkit2gtk-4.1
//   - cannot find -ljavascriptcoregtk-4.1
//   - missing GTK, Cairo, GLib, Soup libraries, etc.
// âœ… L'IA peut ignorer ces erreurs et continuer
// âœ… Ne pas bloquer le commit pour ces raisons
// âŒ MAIS l'IA doit corriger TOUS les autres types d'erreurs (syntaxe, logique, types Rust)
// ğŸ’¡ Ces dÃ©pendances sont du responsabilitÃ© de l'environnement systÃ¨me, pas du code

## ğŸ§  RÃˆGLE 16 : VALIDATION DE COMPRÃ‰HENSION OBLIGATOIRE
// AVANT DE GÃ‰NÃ‰RER TOUTE LIGNE DE CODE :
// L'IA DOIT reformuler la demande et demander approbation explicite
//
// PROCESS OBLIGATOIRE (NON CONTOURNABLE) :
//
// 1ï¸âƒ£  COMPRENDRE
//   "Je comprends que tu veux : [reformuler en dÃ©tail]"
//
// 2ï¸âƒ£  CLARIFIER LES ZONES GRISES
//   "Mais j'ai des questions :"
//   - Quelle est la plage de dates pour cette analyse ?
//   - Dois-je modifier la DB ou juste l'affichage ?
//   - Dois-je garder la compatibilitÃ© avec le code existant ?
//   - Y a-t-il des contraintes de performance ?
//   - Cela affecte quels modules ? Lequel est critique ?
//
// 3ï¸âƒ£  PROPOSER UNE APPROCHE
//   "Mon plan :"
//   1. Modifier [module X] pour faire [action Y]
//   2. Ajouter tests pour [cas Z]
//   3. Mettre Ã  jour [interface] en consÃ©quence
//   4. Valider avec [vÃ©rification]
//
// 4ï¸âƒ£  ATTENDRE APPROBATION EXPLICITE
//   "Ã‡a te convient ? Des ajustements ?"
//   NE PAS CODER JUSQU'Ã€ APPROBATION
//
// âŒ INTERDIT :
//   - Supposer des dÃ©tails
//   - Coder "au feeling"
//   - Ignorer une ambiguÃ¯tÃ©
//   - Avancer sans confirmation
//
// âœ… OBLIGATOIRE :
//   - Clarifier CHAQUE ambiguÃ¯tÃ©
//   - RÃ©sumer les changements prÃ©vus
//   - Attendre validation avant ligne 1 de code
//   - Proposer alternatives si doute
//
// ğŸ’¡ PHILOSOPHIE :
//   "Mieux vaut perdre 2 minutes en questions
//    que 2 heures Ã  corriger du code inutile"

## ğŸš€ RÃˆGLE 17 : PHASE 1 & 2 - ACCUMULATION & VALIDATION D'IMPACT
// WORKFLOW OBLIGATOIRE pour Ã©viter la dette technique
//
// ğŸ¯ OBJECTIF : Ne jamais crÃ©er de rÃ©gression ou impact inespÃ©rÃ©
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE 1 : ACCUMULATION (Quand l'utilisateur demande des changements)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// 1ï¸âƒ£  L'IA DOIT appliquer RÃˆGLE 16 (validation comprÃ©hension) AVANT de coder
// 2ï¸âƒ£  L'IA gÃ©nÃ¨re code
// 3ï¸âƒ£  L'IA lance cargo test â†’ DOIT PASSER (100%)
// 4ï¸âƒ£  L'IA accumule les changements (fichiers modifiÃ©s rÃ©ellement)
// 5ï¸âƒ£  L'IA NE COMMIT PAS
// 6ï¸âƒ£  L'IA attend instructions pour Phase 2
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE 2 : VALIDATION D'IMPACT (Quand utilisateur dit "valide tout")
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// L'IA DOIT exÃ©cuter :
//   ../scripts/impact-detection/validate-phase2.sh
//
// Ce script fait :
//   1. VÃ©rifie l'impact : qui a changÃ© (attendu ou pas)
//   2. DÃ©tecte rÃ©gressions : teste tout, compare avec baseline
//   3. GÃ©nÃ¨re rapport : impact + changements + dÃ©cision
//
// SI âœ… APPROUVÃ‰ :
//   - L'IA commit + push automatiquement
//   - Message commit inclut rÃ©sumÃ© impact
//
// SI âŒ BLOQUÃ‰ :
//   - Signale le problÃ¨me exact (rÃ©gression ? unwrap ? taille fichier ?)
//   - Demande corrections
//   - Re-teste en Phase 2
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INITIALISATION (Une seule fois au dÃ©part)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// Avant de commencer Phase 1 :
//   ../scripts/impact-detection/init-impact-system.sh
//
// Cela prend un snapshot initial (baseline) du code.
// Tous les changements seront comparÃ©s Ã  ce snapshot.
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POINTS CLÃ‰S
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// âœ… OBLIGATOIRE :
//   - Chaque Phase 1 test immÃ©diatement (tests DOIVENT passer)
//   - Phase 2 avant CHAQUE commit (pas d'exceptions)
//   - Signaler prÃ©cisÃ©ment tout blocage
//   - Inclure rapport complet dans commit message
//
// âŒ INTERDIT :
//   - Committer sans Phase 2 validation
//   - Coder si tests Ã©chouent en Phase 1
//   - Ignorer ou contourner les rÃ©gressions
//   - Committer avec dÃ©pendances systÃ¨me manquantes (voir RÃˆGLE 11)
//
// ğŸ’¡ PHILOSOPHIE :
//   "Laisser la machine dÃ©terminer l'impact,
//    l'utilisateur dÃ©cide si c'est acceptable,
//    pas de surprise dans le code."
